<!DOCTYPE html>
<html lang="en">
<head>
  <title>Tutorial 8</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="../../libs/jquery.min.js" type="text/javascript"></script>
  <script src="../../src/js/generator.js" type="text/javascript"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
  <div class="container">
      <div class="row">
          <div class="col-lg-12">
              <div class="panel">
                  <div class="panel-header">
                        <h2> Mata Kuliah Spesial </h2>
                        <div class="pull-left">
                            <div class="pagination">
                                <div class="input-group">
                                    <label for="pagination">
                                        Page
                                    </label>
                                </div>
                                <select id="pagination">
                                </select>
                            </div>
                        </div>
                        <div class="pull-right">
                            <div class="input-group">
                                <label for="showperpage"> Show </label>
                                <select id="showperpage" name="showperpage">
                                    <option> 10 </option>
                                    <option> 20 </option>
                                    <option> 50 </option>
                                </select>
                            </div>
                        </div>
                  </div>
                  <div class="panel-content">
                      <table id="mkstable" class="table table-inverse">
                          <thead>
                              <tr>
                                  <th> ID </th>
                                  <th> Judul </th>
                                  <th> Mahasiswa </th>
                                  <th> Term </th>
                                  <th> Jenis MKS </th>
                                  <th> STATUS </th>
                              </tr>
                          </thead>
                          <tbody></tbody>
                      </table>
                  </div>
              </div>

          </div>
      </div>
  </div>

  <script>
    var currentPage = 0;
    var totalPage = 0;

      function getMks (data) {
          $.ajax({
              url : "../../request/mks.php",
              dataType : "JSON",
              data : data,
              method : "GET",
              success : function (response) {
                  var table = $("#mkstable");
                  var thead = table.find("thead");
                  var tbody = table.find("tbody");
                  console.log("get mks success", response);
                  tbody.empty();
                  totalPage = response.data.total;
                  $.each(response.data.mkslist, function(i, item){
                      var mksItem = "<tr>";
                          mksItem += "<td>" + item['idmks'] + "</td>";
                          mksItem += "<td>" + item['judul'] + "</td>";
                          mksItem += "<td>" + item['nama'] + "</td>";
                          mksItem += "<td>" + item['tahun'] + "\n" + ((item['semester'] == 1) ? ("Gasal" + "</td>") : (item['semester'] == 2) ? "Genap" : "Pendek") + "</td>";
                          mksItem += "<td>" + item['jenis'] + "</td>";
                          mksItem += "<td><ul>" +
                              ((item['ijinmajusidang'] != "f") ? "<li> maju sidang </li> " : "") +
                              ((item['pengumpulanhardcopy'] != "f") ? "<li> kumpul hardcopy </li>" : "") +
                              ((item['issiapsidang'] != "f") ? "<li> siap sidang </li>": "") +
                          "</ul></td>";
                      mksItem += "</tr>";
                      tbody.append(mksItem);
                  });
              },
              error : function (err) {
                  console.log("get mks error", err.responseText);
              }
          });
      }
      $.when(getMks({action : "get_mks_with_payload", skip : 0, take : 10, sort : ""})).then(function(){
          console.log("load done", totalPage);
          for (var i = 1; i <= totalPage; i++) {
              console.log("append");
              var page = '<option value="' + i + '">' + i + '</option>';
              pagination.append(page);
          }
      });
    var pagination = $("#pagination");
    pagination.change(function(){
        currentPage = $(this).val();
        showperpage = $("#showperpage").val();
        var data = {
            action : "get_mks_with_payload",
            skip : currentPage * showperpage,
            take : showperpage,
            sort : ""
        };

        getMks(data);
    });

  </script>
</body>
</html
